## Materials and Methods

All analysis was implemented in Python v3.9 and can be found at <https://github.com/meyer-lab/resistance-MS>.

### Expectation-maximization (EM) algorithm architecture

We constructed a modified mixture model that clusters peptides based on both their abundance across conditions and their peptide sequence. The model is constructed using a given number of clusters and weight/scaling factor to prioritize either the data or the sequence information. Fitting was performed using expectation-maximization, initialized at a random starting point. During the expectation (E) step, the algorithm calculates the probability of each peptide being assigned to each cluster. In the maximization (M) step, each cluster’s distributions are fit using the weighted cluster assignments. The peptide sequence and abundance assignments within the E step are combined by taking the sum of the log-likelihood of both assignments. The peptide log-likelihood is multiplied by a user-defined scaling factor immediately before to influence its importance. Both steps repeat until convergence, as defined by the increase in model likelihood between iterations falling below a user-defined threshold.

### Phosphorylation site abundance clustering in the presence of missing values

We modeled the log-transformed abundance of each phosphopeptide as following a multivariate Gaussian distribution with diagonal covariance. Each dimension of this distribution represents the abundance of that peptide within a given sample. For example, within a data set of 100 patients and 1000 peptides, using 10 clusters, the data is represented by 10 Gaussian distributions of 100 dimensions. Unobserved/missing values were indicated as NaN and ignored during both distribution estimation and when calculating probabilities. Any peptides that were detected in fewer than 10% of all samples were discarded.

### Sequence-cluster comparison

To incorporate information about the sequence of a peptide, we must be able to quantify the similarity between peptides. We applied two separate strategies for doing so, using either a distance matrix or enrichment model. For the first, the weighted average distance between a peptide's sequence and each of those within a cluster was calculated using a PAM250 matrix. For the latter method, a large number of MS-generated phosphorylation sites were collected from a public compendium to be used as the set of background sequences [@PMID:25514926]. This collection of phosphosites was modified so that the set of background sequences followed the same proportion of phosphotyrosine, phosphoserine, and phosphothreonine motifs as the set of foreground sequences. The probability of observing each amino acid residue at each position was independently calculated by comparison to the cluster of interest and the background. First, the sequences in every cluster were used to build counts matrices––number of amino acid occurrences across positions––which were then compared to the background set of sequences using an incomplete beta function as a continuous generalization of the binomial distribution. The probability of the peptide being assigned to that cluster was taken to be the product of each position's probability present in the cluster's binomial probability matrix.

### Quantifying the influence of sequence versus data

The magnitude of the weight used to relatively scale the sequence and data scores during the E-step of the EM algorithm is arbitrary. That is, beyond certainly knowing that with a weight of 0 the model only uses the phosphorylation measurements and with an enormously large weight only the motif information is modeled, non-extreme weights do not indicate to what extent each information source is prioritized. To overcome this challenge, we calculated our clustering results at each weighting extreme, and then calculated the Frobenius norm between our result and either extreme.

### Generation of Cluster Motifs and Prediction of Upstream Kinases

For each cluster we computed a position-specific-scoring matrix (PSSM). To do so, we populated a residue/position matrix with the cumulative sum of the corresponding cluster probabilities for every peptide. Thus, for a particular peptide the same probability will be summed to the corresponding residue/position pairs of the resulting matrix. Once all peptides have been observed, the resulting matrix is normalized by averaging the mean probability across amino acids and log2-transformed to generate a PSSM. In parallel, we computed a PSSM including all sequences that served as background to account for the different amino acid occurrences within the data set. Then, we subtracted each cluster PSSM with the background PSSM as limited any large negative number to -4. Finally, we extracted several kinase specificity profiling results from the literature and computed the Frobenius norm between each cluster's PSSM and every kinase specificity profile to predict kinases displaying a high preference for a particular cluster motif.

### Evaluate clustering by imputation of values

To evaluate the ability of our model to bypass the challenge of handling incomplete data sets, we removed the measurements pertaining to a distinct random individual TMT experiment for every peptide and used the model to attempt to impute these values. The number of missing values per peptide is highly variable. Therefore, in our quantitation we grouped peptides by their missingness percentage and computed the average mean squared error between the actual values and predictions––or imputed peptide average––in each group. Following the same rationale, we computed the reconstruction error across different combinations of clusters number and weights.
