## Materials and Methods

All analysis was implemented in Python, and can be found at <https://github.com/meyer-lab/resistance-MS>.

### Expectation-maximization algorithm architecture

We constructed an EM algorithm that probabilistically and simultaneously models both the peptide phosphorylation levels with a GMM and the peptide sequences using either a PAM250 or binomial position enrichment model. The hyperparameters of this algorithm are the number of clusters and the weight or scaling factor to prioritize either the data or the sequence scores. During the Expectation- or E-step, the algorithm guesses a probability distribution given the current model parameters to assign every peptide into a cluster based on its maximum likelihood estimation, and in the Maximization- or M-step, the algorithm re-estimates the model parameters using the cluster soft assignment probabilities during the previous step. For each cluster during the E-step, the final score is the sum of the GMM and the sequence scores, multiplied by a user-defined weight which scales both scores. A weight of 0 or a very large number only scores the data or sequence, respectively. Then model parameters are updated during the M-step based on the assignments generated during the previous E-step. These two steps repeat until convergence.

### Phosphorylation site abundance clustering in the presence of missing values

We modeled the log-transformed abundance of each phosphopeptide when observed to follow a multivariate Gaussian distribution. Each dimension of this distribution represents the abundance of that peptide within a given sample. For example, within a data set of 100 patients and 1000 peptides, using 10 clusters, the data is represented by 10 Gaussian distributions of 100 dimensions. We assumed that the sample abundances within a cluster had similar within-cluster peptide variation, and independently varied between samples. In other words, the multivariate Gaussian was restricted to have a covariance matrix that is the identity matrix scaled by a shared variance. Conveniently, the EM algorithm underlying the Gaussian Mixture Model enables parameter estimation with incomplete data by guessing the probability distributions using the measured values while ignoring missing data. That is, the maximum likelihood estimation for each Gaussian distribution calculated based on the values that are present for each peptide. Any peptides that were not detected in at least 10% of all samples were discarded.

### Sequence-cluster comparison

To incorporate information about the sequence of a peptide, we must compare each peptide and cluster of peptides. We applied two separate strategies for doing so, using either a distance matrix or enrichment model. For the first, the average distance between a peptide's sequence and each of those within a cluster was calculated using a PAM250 matrix. For the latter method, a large number of MS-generated phosphorylation sites were collected from a public compendium [@PMID:25514926] to be used as the set of background sequences. This collection of phosphosites was modefied so that the set of background sequences followed the exact same proportion of phosphotyrosine, phosphoserine, and phosphothreonine motifs as the set of foreground sequences. The probability of observing each amino acid residue at each position was independently calculated by comparison to the cluster of interest and the background using an incomplete beta function. First, the sequences in every cluster were used to build counts matrices––number of amino acid occurrences across positions––which were then compared to the background set of sequences using a binomially distributed model. The probability of the peptide being assigned to that cluster was taken to be the average of each position's probabililty present in the cluster's binomial probability matrix.

### Sequence-Data wins

The magnitude of the weight used to scale the sequence and data scores during the E-step of the EM algorithm is arbitrary. That is, beyond certainly knowing that with a weight of 0 the model only uses the phosphorylation measurements and with an enormous large weight only the motif information is modeled, any other weight in between does not indicate to what extent each information source is prioritized. To overcome this challenge, we independently observe the probability of cluster membership for every peptide in the data set according to data only (weight=0), sequence only (weight>>>0), or data and sequence (weight=2) and proceed to calculate the Frobenius norm between the latter model and the first two. 

### Generation of Cluster Motifs and Prediction of Upstream Kinases

For each cluster we computed a position-specific-scoring matrix (PSSM). To do so, we populated a residue vs position matrix with the cumulative sum of the corresponding cluster probabilities for every peptide. Thus, for a particular peptide the same probability will be summed to the corresponding residue/position pairs of the resulting matrix. Once all peptides have been observed, the resulting matrix is normalized by averaging the mean probability across amino acids and log2-transformed in order to generate a PSSM. In parallel, we computed a PSSM including all sequences within the that served as background in order to to account for the different amino acid occurrences within the data set. Then, we subtracted each cluster PSSM with the background PSSM as limited any large negative number to -4. Finally, we extracted several kinase specificity profiling results from the literature and computed the Frobenius norm between each cluster's PSSM and every kinase specificity profile to predict kinases displaying a high preference for a particular cluster motif. 


### Evaluate clustering by Introducing Artificial Missingness and Computing Reconstruction Error

To evaluate the ability of our model to bypass the challenge of handling incomplete data sets, we removed the measurements pertaining to a distinct random TMT experiment for every peptide and used the model to attempt to predict them using the average of the cluster a peptide belongs to. The number of missing values per peptide is highly variable. Thus, upon removal of a TMT experiment per peptide, we grouped peptides by their percentage of missingness and computed the average of mean squared errors between the actual values and predictions––or imputed peptide average––in each group. Following the same rationale, we computed the reconstruction error across different combinations of number of clusters and weights.
