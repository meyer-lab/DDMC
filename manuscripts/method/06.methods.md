## Materials and Methods

All analysis was implemented in Python, and can be found at <https://github.com/meyer-lab/resistance-MS>.

### Expectation-maximization algorithm architecture

We constructed an EM algorithm that probabilistically and simultaneously models both the peptide phosphorylation levels with a GMM and the peptide sequences using either a PAM250 or binomial position enrichment model (see below). The hyperparameters of this algorithm are the number of clusters and the weight or scaling factor to prioritize either the data or the sequence scores. during the Expectation- or E-step, the algorithm guesses a probability distribution given the current model parameters to assign every peptide into a cluster based on its maximum likelihood estimation, and in the Maximization- or M-step, the algorithm re-estimates the model parameters using the cluster assignments calculated during the previous step. For each cluster during the E-step, the final score is the sum of the GMM and the sequence scores, multiplied by a user-defined weight which scales both scores. A weight of 0 or a very large number only scores the data or sequence, respectively. Then model parameters are updated during the M-step based on the assignments generated during the previous E-step. These two steps repeat until convergence.

### Phosphorylation site abundance clustering

We modeled the log-transformed abundance of each phosphopeptide when observed to follow a multivariate Gaussian distribution. Each dimension of this distribution represents the abundance of that peptide within a given sample. For example, within a data set of 100 patients and 1000 peptides, using 10 clusters, the data is represented by 10 Gaussian distributions of 100 dimensions. We assumed that the sample abundances within a cluster had similar within-cluster peptide variation, and independently varied between samples. In other words, the multivariate Gaussian was restricted to have a covariance matrix that is the identity matrix scaled by a shared variance.

### Sequence-cluster comparison

To incorporate information about the sequence of a peptide, we must compare each peptide and cluster of peptides. We applied two separate strategies for doing so, using either a distance matrix or enrichment model. For the first, the average distance between a peptide's sequence and each of those within a cluster was calculated using a PAM250 matrix. For the latter method, a large compendium of MS-generated phosphorylation sites were collected from a public compendium [@PMID:25514926]. The probability of observing each amino acid residue at each position was independently calculated by comparison to the cluster of interest and the background using a binomial distribution. The probability of the peptide being assigned to that cluster was taken to be the product of each position's probabililty.
